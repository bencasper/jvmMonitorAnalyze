#!/bin/bash
TIDDS=$(top -n5 -H | grep -m5 java | perl -pe 's/\e\[?.*?[\@-~] ?//g' | cut -f1 -d' ')
tidd_arr=($TIDDS)
for TIDD in "${tidd_arr[@]}"
do
	echo 'TIDD' $TIDD
	TIDH=$(printf "%x" $TIDD)
	echo 'TIDH' $TIDH
	PID=$(ps -aefL | grep java | grep $TIDD | awk '{print $3}')
	echo 'PID' $PID
	jstack $PID | grep -A500 $TIDH | grep -m1 "^$" -B 500
done
